<?php

namespace Presta\AskeetBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * QuestionRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class QuestionRepository extends EntityRepository
{
	public function findAllJoinedToUser()
	{
		$query = $this->getEntityManager()
		->createQuery('
	            SELECT q, u FROM PrestaAskeetBundle:Question q
	            JOIN q.user u
	            ORDER BY q.createdDate DESC'
		);
	
		try {
			return $query->getResult();
		} catch (\Doctrine\ORM\NoResultException $e) {
			return null;
		}
	}
	
	public function findOneByIdJoinedToOther($id)
	{
	    $query = $this->getEntityManager()
	        ->createQuery('
	            SELECT q, u, a FROM PrestaAskeetBundle:Question q
	            JOIN q.user u
	            LEFT JOIN q.answers a
	            WHERE q.id = :id
	            ORDER BY a.createdDate DESC'
	        )->setParameter('id', $id);
	
	    try {
	        return $query->getSingleResult();
	    } catch (\Doctrine\ORM\NoResultException $e) {
	        return null;
	    }
	}
	
}